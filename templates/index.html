<html>
  <head>
    <title>AudienceViewer</title>
    <meta charser = "utf-8">
    <nostroke>
      <style>
        .main-content{
          display:none;
      }
      </style>
    </nostroke>
    <style>
        .controls {
            position: absolute;
            bottom: 1em;
            right: 1em;
        }
        .controls .arrow {
            width: 0;
            height: 0;
            border: 2em solid #71E9F4;
            float: left;
            margin-right: 1em;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        .controls .prev {
            border-top-color: transparent;
            border-right-width: 50px;
            border-bottom-color: transparent;
            border-left: 0 transparent;
        }
        .controls .next {
            border-top-color: transparent;
            border-right: 0 transparent;
            border-bottom-color: transparent;
            border-left-width: 50px;
        }
        .controls .prev:hover {
            border-right-color: #13DAEC;
            cursor: pointer;
        }
        .controls .next:hover {
            border-left-color: #13DAEC;
            cursor: pointer;
        }
        .epoch{
          position: absolute;
          width: 100%;
          height: 100%;
        }
        #graph0{
          opacity: 0.5;
        }
        #graph1{
          opacity: 0.5;
        }
        #graph2{
          opacity: 0.5;
        }
        #graph3{
          opacity: 0.5;
        }
    </style>
  </head>
  <body>
    <h1></h1>
    <div id="graph0" class="epoch"></div>
    <div id="graph1" class="epoch"></div>
    <div id="graph2" class="epoch"></div>
    <div id="graph3" class="epoch"></div>
    <div id="pdf-container" class="pdf-page">
    </div>
    <div class="controls">
        <div id="js-prev" class="arrow prev"></div>
        <div id="js-next" class="arrow next"></div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/epoch.min.js') }}"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/epoch.min.css') }}">
    <link rel="stylesheet" href="../static/css/pdf-slide.css">
    <script src="../static/js/build.js"></script>
    <script type="text/javascript">
        const ws = new WebSocket("ws://localhost:8000/publish");
        var left_range = [0, 1];

        var data0 = [{
            label: "camera0",
            values: [],
            range: left_range
        }];
        var data1 = [{
            label: "camera1",
            values: [],
            range: left_range
        }];
        var data2 = [{
            label: "camera2",
            values: [],
            range: left_range
        }];
        var data3 = [{
            label: "camera3",
            values: [],
            range: left_range
        }];

        var lineChart0 = $('#graph0').epoch({
            type: 'time.line',
            data: data0,
            axes: ['left', 'right', 'bottom']
        });
        var lineChart1 = $('#graph1').epoch({
            type: 'time.line',
            data: data1,
            axes: ['left', 'right', 'bottom']
        });
        var lineChart2 = $('#graph2').epoch({
            type: 'time.line',
            data: data2,
            axes: ['left', 'right', 'bottom']
        });
        var lineChart3 = $('#graph3').epoch({
            type: 'time.line',
            data: data3,
            axes: ['left', 'right', 'bottom']
        });

        var graph0 = document.getElementById('graph0');
        var graph1 = document.getElementById('graph1');
        var graph2 = document.getElementById('graph2');
        var graph3 = document.getElementById('graph3');
        ws.onmessage = function(msg) {
            console.log(msg);
            var current = JSON.parse(msg.data);
            lineChart0.push([current[0]]);
            lineChart1.push([current[1]]);
            lineChart2.push([current[2]]);
            lineChart3.push([current[3]]);
            var length = Object.keys(current).length;

            for (var key in current) {
              (function(local) {
                setTimeout(function(){
                  console.log(local + ":" + current[local].y);
                  $('#graph' + local).css('opacity',current[local].y);
                  if (local != 0) {
                    for (var i = 0; i < local; i++) {
                      $('#graph' + i).css('opacity', 0);
                    }
                    if (local != length -1) {
                      for (var i = local + 1; i < Object.keys(current).length; i++) {
                        $('#graph' + i).css('opacity', 0);
                      }
                    }
                  }
                  else {
                    for (var i = 1; i < length; i++) {
                      $('#graph' + i).css('opacity', 0);
                    }
                  }
                  console.log(graph0.style.opacity);
                  console.log(graph1.style.opacity);
                  console.log(graph2.style.opacity);
                  console.log(graph3.style.opacity);
                }, 3000);
              }(key));
            }

        };
    </script>
</body>

</html>
